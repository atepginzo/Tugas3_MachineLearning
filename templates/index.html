<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prediksi Risiko Kredit Profesional</title>
    <style>
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; margin: 0; padding: 2em; background-color: #f7f7f7; color: #333; }
        .container { max-width: 800px; margin: auto; background: white; padding: 2em; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #1a253c; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5em; }
        .form-group { display: flex; flex-direction: column; }
        label { margin-bottom: 0.5em; font-weight: 600; font-size: 0.9em; }
        input, select { padding: 0.8em; border: 1px solid #ccc; border-radius: 4px; font-size: 1em; }
        button { grid-column: 1 / -1; padding: 1em; background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; font-size: 1.1em; font-weight: bold; }
        .result { margin-top: 2em; padding: 1.5em; border-left-width: 5px; border-left-style: solid; border-radius: 5px; }
        .result.safe { border-color: #28a745; background-color: #e9f7ef; }
        .result.risk { border-color: #dc3545; background-color: #f8d7da; }
        .result h3 { margin-top: 0; }
        .presets { background-color: #eef; padding: 1em; border-radius: 5px; margin-bottom: 2em; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sistem Prediksi Risiko Kredit</h1>

        {% if presets %}
        <div class="presets">
            <label for="preset_selector"><b>Isi Form dengan Data Contoh:</b></label>
            <select id="preset_selector" onchange="fillForm(this.value)">
                <option value="">-- Pilih Contoh Nasabah --</option>
                {% for preset in presets %}
                    <option value="{{ loop.index0 }}">Nasabah ID {{ preset['__id__'] }} (Aktual: {{ 'Default' if preset['__label__'] == '1' else 'Aman' }})</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}

        <form action="/" method="post">
            <h2>Data Nasabah</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="LIMIT_BAL">Batas Kredit</label>
                    <input type="number" name="LIMIT_BAL" required>
                </div>
                <div class="form-group">
                    <label for="AGE">Usia</label>
                    <input type="number" name="AGE" required>
                </div>
                <div class="form-group">
                    <label for="SEX">Jenis Kelamin</label>
                    <select name="SEX">
                        <option value="1">Laki-laki</option>
                        <option value="2">Perempuan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="EDUCATION">Pendidikan</label>
                    <select name="EDUCATION">
                        <option value="1">Pascasarjana</option>
                        <option value="2">Universitas</option>
                        <option value="3">SMA</option>
                        <option value="4">Lainnya</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="MARRIAGE">Status Pernikahan</label>
                    <select name="MARRIAGE">
                        <option value="1">Menikah</option>
                        <option value="2">Lajang</option>
                        <option value="3">Lainnya</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="PAY_0">Status Bayar (Bulan Lalu)</label>
                    <input type="number" name="PAY_0" placeholder="-1=Lunas, 1=Telat 1 bln" required>
                </div>
                </div>
            <br>
            <button type="submit">Dapatkan Prediksi</button>
        </form>

        {% if prediction_label %}
        <div class="result {{ 'safe' if 'Tidak' in prediction_label else 'risk' }}">
            <h3>Hasil Prediksi: {{ prediction_label }}</h3>
            {% if default_probability is not none %}
                <p>Probabilitas Gagal Bayar: <strong>{{ "%.2f"|format(default_probability * 100) }}%</strong></p>
            {% endif %}
        </div>
        {% endif %}
    </div>

     <div style="margin-top: 2.5em; padding: 1.5em; background-color: #f0f6ff; border-radius: 8px; border: 1px solid #cce0ff;">
            <h2 style="text-align: center; color: #1a253c; margin-top: 0;">Grafik Analisis</h2>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5em;">
                
                <div style="border: 1px solid #ddd; border-radius: 5px; padding: 0.5em; background-color: #fff;">
                    <img src="{{ url_for('static', filename='confusion matrix.png') }}" alt="Confusion Matrix" style="max-width: 100%; height: auto; display: block;">
                </div>
                
                <div style="border: 1px solid #ddd; border-radius: 5px; padding: 0.5em; background-color: #fff;">
                    <img src="{{ url_for('static', filename='ROC.png') }}" alt="Kurva ROC" style="max-width: 100%; height: auto; display: block;">
                </div>
                
                <div style="border: 1px solid #ddd; border-radius: 5px; padding: 0.5em; background-color: #fff;">
                    <img src="{{ url_for('static', filename='korelasi antar fitur.png') }}" alt="Korelasi Antar Fitur" style="max-width: 100%; height: auto; display: block;">
                </div>

                <div style="border: 1px solid #ddd; border-radius: 5px; padding: 0.5em; background-color: #fff;">
                    <img src="{{ url_for('static', filename='grafik distribusi target.png') }}" alt="Grafik Distribusi Target" style="max-width: 100%; height: auto; display: block;">
                </div>

            </div>
        </div>
        </div> </body>

    <script>
        // Data presets dari Flask akan dimasukkan ke sini
        const presets = {{ presets|tojson }};

        function fillForm(index) {
            if (index === "") return; // Jika "-- Pilih Contoh --" dipilih

            const data = presets[parseInt(index)];
            
            // Loop melalui semua data di preset dan isi form yang sesuai
            for (const key in data) {
                const element = document.querySelector(`[name="${key}"]`);
                if (element) {
                    element.value = data[key];
                }
            }
        }
    </script>
</body>
</html>